default_platform(:ios)

platform :ios do
  desc "Build rápido para CI (simulador, sin firma)"
  lane :build_ci do
    # Si aún NO existe el proyecto Xcode, salimos sin fallar.
    xcodeproj_paths = Dir["*.xcodeproj"]
    if xcodeproj_paths.empty?
      UI.message("No hay .xcodeproj todavía. Build omitido.")
      return
    end

    build_app(
      scheme: "Clinyco",        # ajústalo al nombre real de tu scheme cuando exista
      sdk: "iphonesimulator",
      skip_codesign: true
    )
  end

  desc "Build y subir a TestFlight (activar cuando haya firma)"
  lane :beta do
    # match(type: "appstore", readonly: false)  # descomenta si usas match

    increment_build_number(xcodeproj: "Clinyco.xcodeproj")
    build_app(
      scheme: "Clinyco",
      export_method: "app-store"
    )
    upload_to_testflight(
      distribute_external: false,
      changelog: ENV["CHANGELOG"] || "Build automático"
    )
  end
end
